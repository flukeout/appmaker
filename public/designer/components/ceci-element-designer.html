<polymer-element name="ceci-element" extends="ceci-element-base">
  <template id="ceci-element">
    <style>
      :host {
        position: relative;
        width: 100%;
        top: 0;
      }

      :host:hover {
        box-shadow: 0 0 0 2px rgba(255,125,0,0.2);
      }

      :host .handle {
        position: absolute;
        right: 0;
        top: 0;
        border-radius: 2px;
        background-color: white;
        border: solid 1px #BBB;
        width: 22px;
        height: 22px;
        cursor: move;
        background-image: url('/designer/images/move.png');
        background-repeat: no-repeat;
        background-position: center;
        background-size: 12px;
        margin: 3px;
        z-index: 9999;
        visibility: hidden;
        display: block;
      }

      :host .delete-component
       {
        background-size: 10px;
        position: absolute;
        z-index: 110;
        height: 22px;
        width: 22px;
        background-position: center;
        background-color: transparent;
        background-repeat: no-repeat;
        background-size: 12px;
        cursor: pointer;
        border-radius: 2px;
        background-color: white;
        border: solid 1px #BBB;
        top: 3px;
        right: 30px;
        cursor: pointer;
        visibility: hidden;
        background-image: url('/designer/images/delete.png');
      }


      :host:hover > .handle {
        visibility: visible;
      }

      :host:hover > .delete-component {
        visibility: visible;
      }

    </style>
    <content></content>

    <div on-click="{{deleteComponent}}" class="delete-component"></div>

    <ceci-listen-vis></ceci-listen-vis>
    <ceci-channel-menu channelType="listen"></ceci-channel-menu>

    <ceci-broadcast-vis></ceci-broadcast-vis>
    <ceci-channel-menu channelType="broadcast"></ceci-channel-menu>
  </template>
  <script>
    Polymer('ceci-element', {
      broadcast: function(name, data) {
        this.super(arguments);
        var broadcastElement = this.querySelector('ceci-broadcast[from="' + name + '"]');
        if (broadcastElement) {
          this.log(broadcastElement.on, 'broadcasts', name);
          var broadcastDetails = { channel : broadcastElement.on, handler : name, data: data};
          this.dispatchEvent(new CustomEvent('broadcastFired', {name: name, bubbles: true, detail: broadcastDetails}));
        }
      },
      deleteComponent : function(e){
        this.parentNode.removeChild(this);
        var event = new CustomEvent("component-deleted");
        window.dispatchEvent(event);
      },
      log: function(eventChannel, eventType, eventName) {
        var message = {};
        message.component = this.tagName.substr(5);
        message.eventChannel = eventChannel;
        message.eventType = eventType;
        message.eventName = eventName;
        this.dispatchEvent(new CustomEvent('log', {bubbles: true, detail: message}));
      },
      enteredView: function() {
        var handle = document.createElement("div");
        handle.classList.add("handle");
        this.appendChild(handle);

        this.super();
      }
    });
  </script>
</polymer-element>
